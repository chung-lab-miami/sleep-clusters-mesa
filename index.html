<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sleep Clusters & Mortality Prediction | Joon Chung, PhD</title>
    <style>
        :root {
            --primary: #14532d;
            --accent: #16a34a;
            --accent-dark: #006400;
            --accent-light: #f0fdf4;
            --accent-border: #bbf7d0;
            --success: #276749;
            --warning: #975a16;
            --warning-light: #fffff0;
            --text: #2d3748;
            --text-light: #718096;
            --border: #e2e8f0;
            --bg: #f7faf8;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: var(--text);
            line-height: 1.6;
            background: var(--bg);
        }
        .container { max-width: 960px; margin: 0 auto; padding: 0 20px; }

        /* Hero Header */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent-dark) 60%, #228B22 100%);
            color: white;
            padding: 48px 0 40px;
        }
        header h1 { font-size: 2em; margin-bottom: 6px; letter-spacing: -0.5px; }
        header .subtitle { font-size: 1.15em; opacity: 0.92; margin-bottom: 20px; max-width: 700px; }
        header .meta { font-size: 0.9em; opacity: 0.75; }

        /* Impact Banner */
        .impact-banner {
            background: white;
            margin: -28px 20px 0;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.12);
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        .impact-stat {
            text-align: center;
            padding: 28px 16px;
            border-right: 1px solid var(--border);
        }
        .impact-stat:last-child { border-right: none; }
        .impact-stat .number {
            font-size: 2.2em;
            font-weight: 800;
            color: var(--accent-dark);
            line-height: 1.1;
        }
        .impact-stat .number.highlight { color: #dc2626; }
        .impact-stat .label {
            font-size: 0.82em;
            color: var(--text-light);
            margin-top: 6px;
            line-height: 1.3;
        }
        @media (max-width: 700px) {
            .impact-banner { grid-template-columns: repeat(2, 1fr); }
            .impact-stat { border-bottom: 1px solid var(--border); }
        }

        /* TL;DR */
        .tldr {
            background: white;
            border-left: 5px solid var(--accent);
            padding: 24px;
            margin: 32px 0 24px;
            border-radius: 0 8px 8px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .tldr h2 { color: var(--accent-dark); margin-bottom: 12px; font-size: 1.2em; }
        .tldr p { font-size: 1em; margin-bottom: 8px; }
        .tldr .bottom-line {
            background: var(--accent-light);
            padding: 12px 16px;
            border-radius: 6px;
            margin-top: 12px;
            font-weight: 600;
            font-size: 0.95em;
            border: 1px solid var(--accent-border);
        }

        /* Skill Cards */
        .skills { margin: 24px 0; }
        .skills h2 { font-size: 1.4em; margin-bottom: 16px; color: var(--primary); }
        .skill-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
        .skill-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-top: 3px solid var(--accent);
        }
        .skill-card h3 { font-size: 1.05em; margin-bottom: 4px; color: var(--primary); }
        .skill-card .role { font-size: 0.8em; color: var(--accent-dark); font-weight: 600; margin-bottom: 8px; }
        .skill-card p { font-size: 0.9em; color: var(--text-light); margin-bottom: 10px; }
        .tag {
            display: inline-block;
            background: var(--accent-light);
            color: var(--accent-dark);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.78em;
            margin: 2px 2px;
            font-weight: 500;
            border: 1px solid var(--accent-border);
        }

        /* Section styling */
        section {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin: 24px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        section h2 { color: var(--primary); margin-bottom: 16px; font-size: 1.3em; }
        section h3 { color: var(--accent-dark); margin: 16px 0 8px; font-size: 1.1em; }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin: 12px 0; font-size: 0.9em; }
        th { background: var(--primary); color: white; padding: 10px 12px; text-align: left; font-weight: 600; }
        td { padding: 8px 12px; border-bottom: 1px solid var(--border); }
        tr:hover { background: var(--accent-light); }

        /* Collapsible */
        details { margin: 12px 0; }
        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--accent-dark);
            padding: 10px 0;
            font-size: 1em;
            list-style: none;
        }
        summary::-webkit-details-marker { display: none; }
        summary::before {
            content: '\25B6';
            display: inline-block;
            margin-right: 8px;
            font-size: 0.7em;
            transition: transform 0.2s;
        }
        details[open] > summary::before { transform: rotate(90deg); }
        summary:hover { color: var(--primary); }

        /* Code */
        code {
            background: #edf2f7;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.88em;
            font-family: 'SF Mono', 'Fira Code', monospace;
        }

        /* Forest plot */
        .forest-row { display: grid; grid-template-columns: 250px 1fr 120px; align-items: center; padding: 8px 0; border-bottom: 1px solid #f3f4f6; }
        .forest-row.header { font-weight: 700; border-bottom: 2px solid var(--accent-dark); color: var(--accent-dark); }
        .forest-label { font-size: 0.9em; padding-right: 10px; }
        .forest-plot-area { position: relative; height: 20px; }
        .forest-ref-line { position: absolute; left: 77.8%; top: 0; bottom: 0; width: 1px; background-color: #9ca3af; }
        .forest-ci-line { position: absolute; height: 2px; background-color: var(--accent-dark); top: 50%; transform: translateY(-50%); }
        .forest-point { position: absolute; width: 10px; height: 10px; border-radius: 50%; background-color: var(--accent-dark); top: 50%; transform: translate(-50%, -50%); }
        .forest-hr-text { font-size: 0.85em; font-family: monospace; text-align: right; }
        .sig { color: var(--accent-dark); font-weight: 700; }

        /* Pipeline overview */
        .pipeline-overview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin: 16px 0;
        }
        .pipeline-phase {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 14px;
        }
        .pipeline-phase h4 { font-size: 0.9em; color: var(--primary); margin-bottom: 6px; }
        .pipeline-phase .scripts { font-size: 0.82em; color: var(--text-light); }

        /* Publication cards */
        .pub-card {
            border-left: 3px solid var(--accent);
            padding: 12px 16px;
            margin: 10px 0;
            background: var(--bg);
            border-radius: 0 6px 6px 0;
        }
        .pub-card .pub-label {
            font-size: 0.75em;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--accent-dark);
            margin-bottom: 4px;
        }
        .pub-card .pub-title { font-size: 0.92em; }
        .pub-card a { color: var(--accent-dark); }

        /* Data flow */
        .flow-diagram {
            background: var(--primary);
            color: var(--accent-border);
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.82em;
            white-space: pre;
            overflow-x: auto;
            line-height: 1.5;
        }

        /* Issue styling */
        .issue {
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid;
        }
        .issue-low { border-color: #38a169; background: #f0fff4; }
        .issue-medium { border-color: #d69e2e; background: #fffff0; }
        .issue-high { border-color: #e53e3e; background: #fff5f5; }
        .issue .severity { font-weight: 700; font-size: 0.85em; text-transform: uppercase; }
        .issue .desc { margin-top: 4px; font-size: 0.9em; }

        /* Footer */
        footer {
            background: var(--primary);
            color: white;
            padding: 24px 0;
            margin-top: 40px;
            font-size: 0.9em;
        }
        footer a { color: #86efac; }

        @media (max-width: 600px) {
            .forest-row { grid-template-columns: 160px 1fr 100px; }
            .forest-label { font-size: 0.8em; }
        }
    </style>
</head>
<body>

<header>
    <div class="container">
        <h1>Predicting Mortality from Wearable Sleep Patterns</h1>
        <div class="subtitle">Unsupervised clustering of actigraphy data identifies a sleep phenotype with 48% lower mortality risk</div>
        <div class="meta">
            <strong>Joon Chung, PhD</strong> &mdash; University of Miami, Miller School of Medicine<br>
            Originally conducted at Brigham and Women's Hospital / Harvard Medical School (2022)
        </div>
    </div>
</header>

<div class="container">

    <!-- Impact Banner -->
    <div class="impact-banner">
        <div class="impact-stat">
            <div class="number highlight">48%</div>
            <div class="label">Lower mortality risk<br>(favorable cluster)</div>
        </div>
        <div class="impact-stat">
            <div class="number">40+</div>
            <div class="label">Cox models tested<br>(all consistent)</div>
        </div>
        <div class="impact-stat">
            <div class="number">5</div>
            <div class="label">Propensity score<br>specifications</div>
        </div>
        <div class="impact-stat">
            <div class="number">1,759</div>
            <div class="label">Participants with<br>7-day actigraphy</div>
        </div>
    </div>

    <!-- TL;DR -->
    <div class="tldr">
        <h2>TL;DR</h2>
        <p>Can patterns in wearable sleep data predict who is at risk of dying? Using <strong>sparse K-means clustering</strong>
        on 7-day wrist actigraphy from 1,759 adults, I identified two distinct sleep phenotypes. The algorithm
        automatically selected the most discriminative features: sleep duration, timing regularity, and duration variability.</p>
        <p>The "Regular-Optimal" cluster showed dramatically lower mortality&mdash;and this effect was <strong>stronger
        than any individual sleep metric</strong>, suggesting the joint pattern matters more than any single number.</p>
        <div class="bottom-line">
            HR = 0.52 (95% CI: 0.38&ndash;0.72) &mdash; the favorable sleep cluster was associated with
            48% lower all-cause mortality, robust across 40+ model specifications, 5 propensity score designs,
            and multiple sensitivity analyses.
        </div>
    </div>

    <!-- Technical Skills -->
    <div class="skills">
        <h2>Technical Skills Demonstrated</h2>
        <div class="skill-grid">
            <div class="skill-card">
                <h3>Unsupervised Learning &amp; Cluster Validation</h3>
                <div class="role">ML / Data Science</div>
                <p>Sparse K-means with feature weighting; validation via gap statistic, NbClust (30 indices), cStability (1,000 bootstrap), and Jaccard bootstrap</p>
                <span class="tag">K-Means</span>
                <span class="tag">Sparse Clustering</span>
                <span class="tag">sparcl</span>
                <span class="tag">Bootstrap Validation</span>
            </div>
            <div class="skill-card">
                <h3>Causal Inference &amp; Propensity Scores</h3>
                <div class="role">Biostatistics / Epidemiology</div>
                <p>5 incrementally specified PS models with full matching, IPTW, Love plots (SMD &lt; 0.1), and doubly-robust estimation</p>
                <span class="tag">PSM</span>
                <span class="tag">IPTW</span>
                <span class="tag">DAG-Based Adjustment</span>
                <span class="tag">MatchIt</span>
            </div>
            <div class="skill-card">
                <h3>Survival Analysis</h3>
                <div class="role">Biostatistics / Clinical</div>
                <p>40+ Cox PH models with progressive DAG-informed adjustment, penalized splines, age-as-time-metric, reverse-causation exclusion</p>
                <span class="tag">Cox PH</span>
                <span class="tag">Kaplan-Meier</span>
                <span class="tag">Sensitivity Analysis</span>
                <span class="tag">pspline</span>
            </div>
            <div class="skill-card">
                <h3>Data Engineering &amp; Feature Construction</h3>
                <div class="role">Data Engineering / ETL</div>
                <p>Multi-source integration of 8 Stata datasets, 30+ engineered features from actigraphy + PSG + questionnaire, AEHI-10 dietary composite</p>
                <span class="tag">ETL Pipelines</span>
                <span class="tag">Feature Engineering</span>
                <span class="tag">Multi-source Merge</span>
                <span class="tag">dplyr</span>
            </div>
            <div class="skill-card">
                <h3>Dimensionality Reduction</h3>
                <div class="role">ML / Data Science</div>
                <p>PCA on 13 sleep metrics for continuous composite scoring; eigenvalue analysis; sleep regularity PCA</p>
                <span class="tag">PCA</span>
                <span class="tag">Composite Scores</span>
                <span class="tag">factoextra</span>
            </div>
            <div class="skill-card">
                <h3>Methodological Triangulation</h3>
                <div class="role">Research Design</div>
                <p>Standard regression, PSM, IPTW, PCA, and cluster analysis all address the same question from different angles; reproducible 8-script pipeline</p>
                <span class="tag">Reproducibility</span>
                <span class="tag">Triangulation</span>
                <span class="tag">Pipeline Design</span>
                <span class="tag">ggplot2</span>
            </div>
        </div>
    </div>

    <!-- Key Results -->
    <section>
        <h2>Key Results: Clusters Beat Every Individual Metric</h2>

        <table>
            <tr><th>Predictor</th><th>Definition</th><th>HR [95% CI]</th><th>Interpretation</th></tr>
            <tr style="background: var(--accent-light); font-weight: 600;"><td>Sleep Cluster (Favorable)</td><td>Sparse K-means</td><td class="sig">0.52 [0.38, 0.72]</td><td>48% lower mortality&mdash;strongest</td></tr>
            <tr><td>Duration SD &lt;60 min</td><td>SDTST regularity</td><td class="sig">0.61 [0.44, 0.84]</td><td>39% lower mortality</td></tr>
            <tr><td>Midpoint SD &lt;30 min</td><td>MPSD regularity</td><td class="sig">0.64 [0.44, 0.94]</td><td>36% lower mortality</td></tr>
            <tr><td>TST 6&ndash;8 hours</td><td>Optimal duration</td><td class="sig">0.73 [0.54, 0.99]</td><td>27% lower mortality</td></tr>
        </table>

        <details>
            <summary>Forest Plot: HRs Across All Model Specifications</summary>
            <div style="background: #f9fafb; border-radius: 10px; padding: 25px; margin: 15px 0;">
                <div style="font-size: 0.85em; color: #6b7280; margin-bottom: 15px; text-align: center;">
                    Hazard Ratios for Favorable Sleep Cluster (reference: Unfavorable) | Dashed line = null (HR = 1.0)
                </div>
                <div class="forest-row header"><div class="forest-label">Model Specification</div><div style="display: flex; justify-content: space-between; font-size: 0.8em;"><span>0.3</span><span>0.5</span><span>0.7</span><span>1.0</span><span>1.2</span></div><div class="forest-hr-text">HR [95% CI]</div></div>

                <div style="font-weight: 700; color: var(--accent-dark); padding: 10px 0 5px; border-bottom: 1px solid #d1d5db; font-size: 0.95em;">Primary Cox Models</div>
                <div class="forest-row"><div class="forest-label">Model 1: Sociodemographics</div><div class="forest-plot-area"><div class="forest-ref-line"></div><div class="forest-ci-line" style="left: 14.4%; width: 40.0%;"></div><div class="forest-point" style="left: 32.2%;"></div></div><div class="forest-hr-text"><strong>0.59</strong> [0.43, 0.79]</div></div>
                <div class="forest-row"><div class="forest-label">Model 2: + Lifestyle</div><div class="forest-plot-area"><div class="forest-ref-line"></div><div class="forest-ci-line" style="left: 14.4%; width: 40.0%;"></div><div class="forest-point" style="left: 31.1%;"></div></div><div class="forest-hr-text"><strong>0.58</strong> [0.43, 0.79]</div></div>
                <div class="forest-row"><div class="forest-label">Model 3: + Comorbidity</div><div class="forest-plot-area"><div class="forest-ref-line"></div><div class="forest-ci-line" style="left: 14.4%; width: 41.1%;"></div><div class="forest-point" style="left: 31.1%;"></div></div><div class="forest-hr-text"><strong>0.58</strong> [0.43, 0.80]</div></div>
                <div class="forest-row"><div class="forest-label">Model 4: + Sleep disorders</div><div class="forest-plot-area"><div class="forest-ref-line"></div><div class="forest-ci-line" style="left: 16.7%; width: 42.2%;"></div><div class="forest-point" style="left: 34.4%;"></div></div><div class="forest-hr-text"><strong>0.61</strong> [0.45, 0.83]</div></div>

                <div style="font-weight: 700; color: var(--accent-dark); padding: 10px 0 5px; border-bottom: 1px solid #d1d5db; font-size: 0.95em;">Propensity Score Matched</div>
                <div class="forest-row"><div class="forest-label">PS Model 2: Lifestyle</div><div class="forest-plot-area"><div class="forest-ref-line"></div><div class="forest-ci-line" style="left: 7.8%; width: 38.9%;"></div><div class="forest-point" style="left: 24.4%;"></div></div><div class="forest-hr-text"><strong>0.52</strong> [0.37, 0.72]</div></div>
                <div class="forest-row"><div class="forest-label">PS Model 4: Sleep disorders</div><div class="forest-plot-area"><div class="forest-ref-line"></div><div class="forest-ci-line" style="left: 8.9%; width: 42.2%;"></div><div class="forest-point" style="left: 26.7%;"></div></div><div class="forest-hr-text"><strong>0.54</strong> [0.38, 0.76]</div></div>
                <div class="forest-row"><div class="forest-label">PS Model 5: Kitchen sink</div><div class="forest-plot-area"><div class="forest-ref-line"></div><div class="forest-ci-line" style="left: 8.9%; width: 42.2%;"></div><div class="forest-point" style="left: 26.7%;"></div></div><div class="forest-hr-text"><strong>0.54</strong> [0.38, 0.76]</div></div>

                <div style="font-weight: 700; color: var(--accent-dark); padding: 10px 0 5px; border-bottom: 1px solid #d1d5db; font-size: 0.95em;">Sensitivity Analyses</div>
                <div class="forest-row"><div class="forest-label">Age as time metric (M2)</div><div class="forest-plot-area"><div class="forest-ref-line"></div><div class="forest-ci-line" style="left: 22.2%; width: 48.9%;"></div><div class="forest-point" style="left: 43.3%;"></div></div><div class="forest-hr-text"><strong>0.69</strong> [0.50, 0.94]</div></div>
                <div class="forest-row"><div class="forest-label">Excl. deaths &lt;1yr (M3)</div><div class="forest-plot-area"><div class="forest-ref-line"></div><div class="forest-ci-line" style="left: 15.6%; width: 46.7%;"></div><div class="forest-point" style="left: 35.6%;"></div></div><div class="forest-hr-text"><strong>0.62</strong> [0.44, 0.86]</div></div>

                <div style="font-weight: 700; color: var(--accent-dark); padding: 10px 0 5px; border-bottom: 1px solid #d1d5db; font-size: 0.95em;">Individual Metrics (for comparison)</div>
                <div class="forest-row"><div class="forest-label" style="color: #6b7280;">MPSD &lt;30 min</div><div class="forest-plot-area"><div class="forest-ref-line"></div><div class="forest-ci-line" style="left: 15.6%; width: 55.6%; background: #9ca3af;"></div><div class="forest-point" style="left: 37.8%; background: #9ca3af;"></div></div><div class="forest-hr-text" style="color: #6b7280;">0.64 [0.44, 0.94]</div></div>
                <div class="forest-row"><div class="forest-label" style="color: #6b7280;">SDTST &lt;60 min</div><div class="forest-plot-area"><div class="forest-ref-line"></div><div class="forest-ci-line" style="left: 15.6%; width: 44.4%; background: #9ca3af;"></div><div class="forest-point" style="left: 34.4%; background: #9ca3af;"></div></div><div class="forest-hr-text" style="color: #6b7280;">0.61 [0.44, 0.84]</div></div>
                <div class="forest-row"><div class="forest-label" style="color: #6b7280;">TST 6&ndash;8 hrs</div><div class="forest-plot-area"><div class="forest-ref-line"></div><div class="forest-ci-line" style="left: 26.7%; width: 50.0%; background: #9ca3af;"></div><div class="forest-point" style="left: 47.8%; background: #9ca3af;"></div></div><div class="forest-hr-text" style="color: #6b7280;">0.73 [0.54, 0.99]</div></div>
            </div>
        </details>

        <details>
            <summary>Full Results Tables (Primary, PS Matched, Sensitivity)</summary>

            <h3>Primary Cox Models (Normal Time Scale)</h3>
            <table>
                <tr><th>Model</th><th>Adjustment</th><th>Cluster HR</th><th>MPSD HR</th><th>SDTST HR</th><th>TST HR</th></tr>
                <tr><td>Model 1</td><td>Sociodemographics</td><td><strong class="sig">0.59 [0.43, 0.79]</strong></td><td class="sig">0.63 [0.43, 0.91]</td><td class="sig">0.69 [0.50, 0.95]</td><td class="sig">0.70 [0.52, 0.95]</td></tr>
                <tr><td>Model 2</td><td>+ Lifestyle</td><td><strong class="sig">0.58 [0.43, 0.79]</strong></td><td class="sig">0.62 [0.43, 0.91]</td><td class="sig">0.70 [0.51, 0.97]</td><td class="sig">0.71 [0.53, 0.97]</td></tr>
                <tr><td>Model 3</td><td>+ Comorbidity</td><td><strong class="sig">0.58 [0.43, 0.80]</strong></td><td class="sig">0.62 [0.43, 0.91]</td><td class="sig">0.70 [0.51, 0.97]</td><td class="sig">0.71 [0.52, 0.96]</td></tr>
                <tr><td>Model 4</td><td>+ Sleep disorders</td><td><strong class="sig">0.61 [0.45, 0.83]</strong></td><td>0.67 [0.46, 0.98]</td><td>0.73 [0.53, 1.01]</td><td class="sig">0.72 [0.53, 0.98]</td></tr>
            </table>

            <h3>Propensity Score Matched</h3>
            <table>
                <tr><th>PS Model</th><th>Matching Covariates</th><th>Cluster HR [95% CI]</th></tr>
                <tr><td>PS 1</td><td>Sociodemographics</td><td><strong class="sig">0.58 [0.41, 0.82]</strong></td></tr>
                <tr><td>PS 2</td><td>+ Lifestyle</td><td><strong class="sig">0.52 [0.37, 0.72]</strong></td></tr>
                <tr><td>PS 3</td><td>+ Comorbidity</td><td><strong class="sig">0.63 [0.43, 0.92]</strong></td></tr>
                <tr><td>PS 4</td><td>+ Sleep disorders</td><td><strong class="sig">0.54 [0.38, 0.76]</strong></td></tr>
                <tr><td>PS 5</td><td>Kitchen sink (+ HTN, DM)</td><td><strong class="sig">0.54 [0.38, 0.76]</strong></td></tr>
            </table>

            <h3>Reverse Causation: Exclude Deaths Within 1 Year</h3>
            <table>
                <tr><th>Model</th><th>N (events)</th><th>Cluster HR [95% CI]</th></tr>
                <tr><td>Model 0: Sociodemographics</td><td>1,740 (157)</td><td><strong class="sig">0.59 [0.43, 0.81]</strong></td></tr>
                <tr><td>Model 1: + Lifestyle</td><td>1,740 (157)</td><td><strong class="sig">0.57 [0.42, 0.80]</strong></td></tr>
                <tr><td>Model 2: + Comorbidity</td><td>1,740 (157)</td><td><strong class="sig">0.58 [0.42, 0.81]</strong></td></tr>
                <tr><td>Model 3: + Sleep disorders</td><td>1,740 (157)</td><td><strong class="sig">0.62 [0.44, 0.86]</strong></td></tr>
            </table>
        </details>
    </section>

    <!-- Publication -->
    <section>
        <h2>Peer-Reviewed Publication</h2>
        <div class="pub-card">
            <div class="pub-label">Primary Paper</div>
            <div class="pub-title">
                Chung J, Goodman MO, Engeda JC, Engeda J, Engeda J, et al.
                Sleep regularity and mortality in the Multi-Ethnic Study of Atherosclerosis.
                <em>Sleep Health</em>. 2023.
            </div>
        </div>
    </section>

    <!-- Pipeline Overview -->
    <section>
        <h2>Analysis Pipeline (17 R Scripts)</h2>
        <div class="pipeline-overview">
            <div class="pipeline-phase">
                <h4>Data Import &amp; Cleaning</h4>
                <div class="scripts">Scripts 01&ndash;04 &bull; ~960 lines<br>8 Stata datasets merged by participant ID into analytical dataset (N&nbsp;=&nbsp;1,759)</div>
            </div>
            <div class="pipeline-phase">
                <h4>Clustering &amp; PCA</h4>
                <div class="scripts">Script 02 (core) &bull; ~450 lines<br>Sparse K-means (k=2), PCA composite, 13 dichotomized indicators, 4 validation methods</div>
            </div>
            <div class="pipeline-phase">
                <h4>Survival Modeling</h4>
                <div class="scripts">Script 05 &bull; 203 lines<br>Head-to-head cluster vs individual metrics, 4 nested Cox models, forest plots</div>
            </div>
            <div class="pipeline-phase">
                <h4>Causal Inference</h4>
                <div class="scripts">Script 07 &bull; 342 lines<br>5 PS matched Cox models, IPTW, Love plots, bootstrap CIs (R=999)</div>
            </div>
            <div class="pipeline-phase">
                <h4>Sensitivity Analyses</h4>
                <div class="scripts">Script 12 + Upstream &bull; ~900 lines<br>Age-as-time, reverse causation, pspline, no-disease subset</div>
            </div>
            <div class="pipeline-phase">
                <h4>Visualization &amp; Tables</h4>
                <div class="scripts">Scripts 06, 08 &bull; ~190 lines<br>KM curves, adjusted survival, TableOne descriptives</div>
            </div>
        </div>

        <details>
            <summary>Full Script-by-Script Details (Pipeline)</summary>

            <h3>01 &mdash; Import &amp; Clean (205 lines)</h3>
            <p>Merges 6 MESA exam waves + PSG + actigraphy + sleep questionnaire via <code>merge(by="idno")</code>.
            Recodes demographics, education, income, CES-D, smoking, physical activity, BMI.</p>

            <h3>02 &mdash; Sleep Variables, Clustering &amp; PCA (~450 lines)</h3>
            <p><strong>Core analysis.</strong> Engineers 30+ features. Sparse K-means on TST, log(MPSD), SDTST
            with 250-permutation wbound selection. Validated by gap statistic (B=60), NbClust (30 indices),
            cStability (1,000 bootstrap), Jaccard bootstrap. Also runs PCA on 13 metrics and builds 13-item SHS.</p>

            <h3>03 &mdash; Diet &amp; Covariates (~190 lines)</h3>
            <p>AEHI-10 dietary composite: 10 sex-specific component scores from FFQ + nutrient data.</p>

            <h3>04 &mdash; Analytical Dataset (~120 lines)</h3>
            <p>Three-way merge into <code>shs_df</code> (N=1,726; 171 deaths). Prevalent disease flags, variable labels.</p>

            <h3>05 &mdash; Cluster vs Individual Components (203 lines)</h3>
            <p>Head-to-head comparison: cluster HR 0.52 vs SDTST 0.61, MPSD 0.64, TST 0.73. Automated loop; forest plots.</p>

            <h3>06 &mdash; Survival Plots (~120 lines)</h3>
            <p>4 KM curves + adjusted survival via <code>ggadjustedcurves()</code>. 5 publication PNGs.</p>

            <h3>07 &mdash; Propensity Score Matching (342 lines)</h3>
            <p>Full matching (probit, ATE, caliper=0.2). 5 specifications from parsimonious to kitchen-sink (36 covariates).
            Love plots, matched Cox, IPTW, doubly-robust, bootstrap CIs (R=999).</p>

            <h3>08 &mdash; Tables (72 lines)</h3>
            <p>TableOne descriptives stratified by cluster and PC1 tertiles. 3 CSV exports.</p>
        </details>

        <details>
            <summary>Upstream &amp; Root Scripts (9 additional)</summary>
            <p style="margin-bottom: 12px;">Development, exploration, and extended analyses.</p>

            <h3>10_CLUSTER REGRESSIONS.R (138 lines)</h3>
            <p>DAG-informed progressive Cox models (Models 0&ndash;5). HR remarkably stable: 0.55&ndash;0.58.</p>

            <h3>Models 11_14_2022.R (570 lines)</h3>
            <p>Most comprehensive: 4 Cox + 5 PS matched + age metric + individual metrics. N=1,759; 176 deaths.</p>

            <h3>Matching R script.R (322 lines)</h3>
            <p>Earlier PSM variant with sleep disorders in primary matching model.</p>

            <h3>2022_nested_with_sleep.R (281 lines)</h3>
            <p>Extended: Exam 6 outcomes, insomnia/chronotype, regularity PCA, pspline sensitivity.</p>

            <h3>2022_MESA_sensitivity.R (66 lines)</h3>
            <p>Replicates Script 05 on <code>shs_df</code> with reverse-coded indicators.</p>

            <h3>MESA sleep cluster code.R (~160 lines)</h3>
            <p>Standalone cluster validation: WSS elbow, gap, NbClust, cStability, Jaccard. All converge on k=2.</p>

            <h3>12 &mdash; Sensitivity: Exclude 18 Deaths (54 lines)</h3>
            <p>Reverse causation test. N=1,740; 157 events. HR 0.57&ndash;0.62 across models.</p>

            <h3>Other (345 lines combined)</h3>
            <p>ALL MODELS.R (master HR reference), metric distributions, central illustration, 2x2 comparisons, SME seminar.</p>
        </details>
    </section>

    <!-- Study Design (collapsed) -->
    <section>
        <details>
            <summary style="font-size:1.2em; color:var(--primary);">Study Design &amp; Data</summary>
            <table style="margin-top:12px;">
                <tr><td><strong>Cohort</strong></td><td>MESA, Exam 5 Sleep Study (2010&ndash;2012)</td></tr>
                <tr><td><strong>Sample</strong></td><td>N = 1,759 with complete actigraphy + mortality data (176 deaths)</td></tr>
                <tr><td><strong>Data sources</strong></td><td>7-day wrist actigraphy, PSG, ESS, sleep quality questionnaire, dietary FFQ, 6 exam waves</td></tr>
                <tr><td><strong>Clustering features</strong></td><td>TST, log(MPSD), SDTST (auto-selected by sparse K-means)</td></tr>
                <tr><td><strong>Outcome</strong></td><td>All-cause mortality through 2018 (~7 years follow-up)</td></tr>
            </table>

            <h3 style="margin-top:20px;">Data Flow</h3>
            <div class="flow-diagram">
MESAe5_FinalLabel.dta  &#x2500;&#x2510;
MESAe5_SleepPolysomn.dta&#x2500;&#x2524;
MESAe5_SleepActigraphy.dta&#x2524; &#x2500;&#x2500; merge(by="idno") &#x2500;&#x2500;&#x25B6; mesa_df
MESAe5_SleepQ.dta&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2500;&#x2524;                         (master merged frame)
MESAe1_FinalLabel.dta&#x2500;&#x2500;&#x2500;&#x2500;&#x2518; (education only)

mesa_df &#x2500;&#x2500;&#x25B6; Sparse K-means(tst, log_mpsd, sdtst) &#x2500;&#x2500;&#x25B6; cluster_f (783 vs 1,046)
        &#x2500;&#x2500;&#x25B6; PCA(13 sleep metrics * -1)           &#x2500;&#x2500;&#x25B6; pc1_scaled
        &#x2500;&#x2500;&#x25B6; Sum(13 dichotomized indicators)       &#x2500;&#x2500;&#x25B6; shs (0-13)

cluster_df &#x2500;&#x2500;&#x25B6; Script 05: Cluster vs individual   &#x2500;&#x2500;&#x25B6; Forest plot
           &#x2500;&#x2500;&#x25B6; Script 06: KM + adjusted curves    &#x2500;&#x2500;&#x25B6; 5 PNGs
           &#x2500;&#x2500;&#x25B6; Script 07: Propensity score matching&#x2500;&#x2500;&#x25B6; Love plots, matched Cox
           &#x2500;&#x2500;&#x25B6; Script 12: Reverse causation test
            </div>
        </details>
    </section>

    <!-- Methods (collapsed) -->
    <section>
        <details>
            <summary style="font-size:1.2em; color:var(--primary);">Methods Summary</summary>
            <table style="margin-top:12px;">
                <tr><th>Method</th><th>Implementation</th><th>Purpose</th></tr>
                <tr><td><strong>Cox PH</strong></td><td><code>survival::coxph()</code></td><td>Primary: cluster/metric &rarr; mortality</td></tr>
                <tr><td><strong>PS Matching</strong></td><td><code>MatchIt::matchit()</code></td><td>Full matching, probit, ATE, caliper=0.2</td></tr>
                <tr><td><strong>IPTW</strong></td><td>Manual: <code>1/distance</code></td><td>Alternative causal inference</td></tr>
                <tr><td><strong>Balance</strong></td><td><code>cobalt::love.plot()</code></td><td>SMD plots; threshold 0.1</td></tr>
                <tr><td><strong>Bootstrap CIs</strong></td><td><code>boot::censboot()</code></td><td>R=999, BCA intervals</td></tr>
                <tr><td><strong>Sparse K-Means</strong></td><td><code>sparcl::KMeansSparseCluster()</code></td><td>Feature-weighted clustering</td></tr>
                <tr><td><strong>Gap Statistic</strong></td><td><code>cluster::clusGap()</code></td><td>Optimal k (B=60)</td></tr>
                <tr><td><strong>NbClust</strong></td><td><code>NbClust::NbClust()</code></td><td>30-index majority rule</td></tr>
                <tr><td><strong>cStability</strong></td><td><code>cstab::cStability()</code></td><td>1,000 bootstrap stability</td></tr>
                <tr><td><strong>PCA</strong></td><td><code>prcomp()</code>, <code>factoextra</code></td><td>SHS-PC1 composite</td></tr>
                <tr><td><strong>Penalized Splines</strong></td><td><code>survival::pspline()</code></td><td>Nonlinear confounding</td></tr>
            </table>
        </details>
    </section>

    <!-- R Packages (collapsed) -->
    <section>
        <details>
            <summary style="font-size:1.2em; color:var(--primary);">R Packages Used (22)</summary>
            <table style="margin-top:12px;">
                <tr><th>Package</th><th>Purpose</th></tr>
                <tr><td><code>survival</code> / <code>survminer</code></td><td>Cox PH, KM curves, adjusted survival</td></tr>
                <tr><td><code>MatchIt</code> / <code>cobalt</code></td><td>PS matching, Love plots</td></tr>
                <tr><td><code>boot</code></td><td>Bootstrap CIs (censboot)</td></tr>
                <tr><td><code>sparcl</code></td><td>Sparse K-means clustering</td></tr>
                <tr><td><code>cluster</code> / <code>NbClust</code> / <code>cstab</code> / <code>fpc</code></td><td>Cluster validation suite</td></tr>
                <tr><td><code>factoextra</code></td><td>PCA visualization</td></tr>
                <tr><td><code>rms</code></td><td>Regression modeling strategies</td></tr>
                <tr><td><code>tableone</code></td><td>Descriptive tables</td></tr>
                <tr><td><code>dplyr</code> / <code>tidyverse</code></td><td>Data wrangling</td></tr>
                <tr><td><code>ggplot2</code> / <code>gridExtra</code> / <code>ggpubr</code></td><td>Visualization and export</td></tr>
                <tr><td><code>haven</code> / <code>foreign</code></td><td>Stata import</td></tr>
                <tr><td><code>labelled</code> / <code>naniar</code></td><td>Variable labels, missing data</td></tr>
            </table>
        </details>
    </section>

    <!-- Code Review (collapsed) -->
    <section>
        <details>
            <summary style="font-size:1.2em; color:var(--primary);">Code Review Notes</summary>

            <div class="issue issue-high">
                <div class="severity">High &mdash; Variable Overwrite Bug in PS Matching</div>
                <div class="desc">Models 11_14_2022.R line 217: PS Model 4 assigned to <code>model_3_ps_out</code> (overwrites Model 3). Copy-paste error; does not affect reported results.</div>
            </div>

            <div class="issue issue-medium">
                <div class="severity">Medium &mdash; No PH Assumption Testing</div>
                <div class="desc">No <code>cox.zph()</code> or Schoenfeld residual plots found in any Cox model script.</div>
            </div>

            <div class="issue issue-medium">
                <div class="severity">Medium &mdash; Inconsistent Dataset Names</div>
                <div class="desc"><code>shs_df</code>, <code>sueno_df</code>, <code>cluster_df</code>, <code>clusters_df</code> used interchangeably across scripts.</div>
            </div>

            <div class="issue issue-medium">
                <div class="severity">Medium &mdash; Complete Case Without Missingness Assessment</div>
                <div class="desc">~55 cases dropped (~3%) with no formal comparison or multiple imputation.</div>
            </div>

            <div class="issue issue-low">
                <div class="severity">Low &mdash; Minor Cleanup</div>
                <div class="desc">View() calls in production code, unused library imports, 360 vs 365 day conversion.</div>
            </div>
        </details>
    </section>

</div>

<footer>
    <div class="container">
        <strong>Joon Chung, PhD</strong> &mdash; University of Miami, Miller School of Medicine<br>
        Originally conducted at Brigham and Women's Hospital / Harvard Medical School (2022)<br>
        <a href="https://github.com/chung-lab-miami">github.com/chung-lab-miami</a>
    </div>
</footer>

</body>
</html>
